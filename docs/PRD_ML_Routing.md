# MCMS ML Routing Automation PRD

## 절대 조건 고지
1. 각 단계는 승인 후에만 진행한다.
2. 단계 착수 전 이번 단계 전체 범위를 리뷰하고 오류를 식별한다.
3. 오류 발견 시 수정 전에 승인 재요청한다.
4. 이전 단계 오류가 없음을 재확인한 뒤 다음 단계 승인을 요청한다.
5. 모든 단계 작업은 백그라운드 방식으로 수행한다.
6. 문서/웹뷰어 점검이 필요한 경우 반드시 승인 확인 후 진행한다.
7. Task list 체크박스를 하나씩 업데이트하면서 문서를 업데이트 한다.

> 모든 팀원은 상기 조건을 매 단계 확인해야 하며, 위 조건을 위반한 작업은 무효 처리한다.

## 1. 프로젝트 한 줄 개요
웹 기반 MCMS 포털과 ESPRIT Edge Add-in을 연동하여 **머신러닝 기반 CAM 라우팅 자동화**와 W:\ 드라이브 자산 관리를 통합한다.

## 2. 주요 목표
| 구분 | 설명 |
|---|---|
| 라우팅 자동화 | 머신러닝 모델이 추천하는 라우팅 후보를 생성하고 사용자가 검토/승인 |
| ESPRIT 연동 | Add-in 팝업에서 필요한 값(API 키, 라우팅 매개변수)을 외부 포털에서 받아와 자동 입력 |
| 파일 관리 | W:\ 공유 드라이브 구조 유지, 버전/메타데이터는 MCMS API에서 관리 |
| 쉬운 사용성 | 주니어도 이해 가능한 트리 기반 UI, 컬러 가이드와 툴팁 제공 |
| 성능 & 확장 | 동시 10명 이상 사용자 대응, 모듈식 구조로 ML 파이프라인 확장 |

## 3. 사용자 페르소나
- **주니어 CAM 엔지니어**: 라우팅 승인/수정, UI 온보딩 필요
- **시니어 프로그래머**: ML 추천 검수, 수정 사항 반영
- **생산 관리자**: 승인 이력, KPI 모니터링
- **ESPIRIT Add-in 운영자**: API 키, 매개변수 관리

## 4. 시스템 아키텍처 (텍스트 다이어그램)
`
[Next.js Web 포털]
    | (REST/GraphQL)
    v
[MCMS API (.NET 8)] --- [SQL Server / ML Feature 스토어]
    |                             |
    | (Queue / REST)             | (ML 모델 API - Python FastAPI)
    v                             v
[MCMS Workers (.NET)] <------> [ML Serving Layer]
    |
    | (HTTPS)
    v
[ESPRIT Edge Add-in (C#)] ----> [W:\ 공유 드라이브]
`

## 5. 주요 기능 정의
| 구분 | 상세 설명 |
|---|---|
| ML 라우팅 추천 | - 공정 데이터 업로드 시 ML 모델이 라우팅 후보를 생성<br>- 추천된 라우팅은 점수화되어 트리 UI에 표시 |
| 트리 기반 UI | - 좌측 트리에 품목/Rev/라우팅 노드 표시<br>- 노드 선택 시 우측 패널에 상세 정보, 파일, 모델 추천 근거 표시 |
| Add-in 연동 | - Add-in이 API를 호출하여 최신 API 키/매개변수를 획득<br>- 팝업 입력은 포털에서 온 값으로 자동 채움 |
| 파일 관리 | - 포털에서 meta.json 생성/다운로드, W:\ 구조 유지<br>- 체크섬/버전 히스토리 관리 |
| 승인 워크플로우 | - ML 추천 → 시니어 검토 → 주니어 승인 → ESPRIT 실행 트리거 |
| 모니터링 | - 10분 간격 상태 대시보드, 모델 성능 지표(정확도, 처리량) |

## 6. UI 구성 상세 (Next.js 기반)
- **상단 헤더**: 검색 바, 사용자 프로필, 실시간 알림
- **좌측 패널**: Tree 컴포넌트
  - 품목 아이콘 + 색상 배지(승인 상태)
  - Drag/Drop 지원(향후)
- **우측 메인**
  1. 요약 카드: 추천 점수, CAM Rev, 마지막 수정자
  2. 탭
     - 라우팅 세부: 공정 단계 표, 공구/설비 정보
     - ML 추천 근거: 피처 중요도, 유사 사례
     - 파일 관리: W:\ 경로 보기, meta.json 다운로드
     - 활동 로그: 승인 히스토리 타임라인
  3. 액션 버튼: 승인, 반려, ESPRIT 실행 요청
- **ESPIRIT 팝업**: 읽기 전용 필드(필요 시 수정 가능), “값 새로고침” 버튼

### 디자인 가이드
- 컬러: Primary #6FA8DC, Secondary #93C47D, Accent #FFD966
- 타이포그래피: Noto Sans KR (기본 14pt, 헤더 18pt)
- 온보딩: 화면 상단 “도움말 모드” 토글, 각 요소에 말풍선 툴팁

## 7. 머신러닝 파이프라인
1. 데이터 수집: 기존 라우팅 이력, 공정 정보, 도구, 결과 KPI
2. 피처 엔지니어링: 라우팅 단계 순서, 설비 매칭, 가공 시간, 품질 지표
3. 모델 학습: Gradient Boosting 혹은 AutoML (초기 PoC: XGBoost)
4. 배포: ML Serving Layer(FastAPI) → API 호출로 점수 반환
5. 모니터링: 모델 정확도, 추천 채택률, 사용자 피드백 로그

## 8. 성능/호환성 요구사항
- 동시 사용자: 10명 이상, 평균 응답시간 1초 이하 (트리 업데이트 기준)
- API 호출: HTTPS, JWT 기반 인증
- Add-in: ESPRIT Edge 2025.1, .NET Framework 4.8 호환
- 클라이언트: Chrome/Edge 최신 버전 지원, 해상도 1280px 이상
- ML 서빙: 100ms 내 추론 응답, 배치/실시간 모드 지원

## 9. 위험 요소 및 대응
| 위험 | 대응 |
|---|---|
| ML 추천 품질 미달 | 시니어 수동 수정 가능, 사용자 피드백 학습에 반영 |
| 네트워크 병목 | Next.js 캐싱, API Rate Limit, W:\ 접근시 비동기 처리 |
| Add-in 인증 실패 | API 키 만료 알림, 재발급 프로세스 제공 |

## 10. 성공 측정 지표
- ML 추천 채택률 60% 이상
- 라우팅 승인 리드타임 30% 단축
- 사용자 만족도(설문) 80점 이상
- 오류/재작업 건수 월 20% 감소

