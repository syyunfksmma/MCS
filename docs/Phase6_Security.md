# Phase 6 - 보안 및 컴플라이언스 계획

## 1. 위협 모델링 요약
- 자산: CAM 파일(Esprit, NC, STL), meta.json, DB 내 생산 이력, CMD 서비스 명령.
- 위협 시나리오
  1. 내부 사용자에 의한 무단 파일 삭제/변조.
  2. 승인되지 않은 사용자가 CAM Rev 변경.
  3. CMD 서비스 명령 오용으로 파일/서비스 손상.
  4. 네트워크 스니핑으로 인한 자격 증명 탈취.
- 완화 전략: 역할 기반 접근 제어, 감사 로그, TLS 암호화, 명령 화이트리스트, 다단계 승인.

## 2. 권한 및 접근 제어
- 인증: 사내 AD SSO, OAuth2/OIDC로 토큰 발급.
- 인가: Role-Based Access Control + 세분화된 Resource Permission (Item/Rev 단위).
- DB/파일 권한: SQL Server 로그인은 애플리케이션 서비스 계정, W: 공유는 AD 그룹별 Read/Write 구분.
- CMD 서비스: 전용 도메인 서비스 계정(`svc_mcms_cmd`), 화이트리스트 명령만 허용.

## 3. 데이터 보호
- 전송 구간 암호화: HTTPS(TLS 1.2 이상), SMB 3.0 암호화 옵션 사용.
- 저장 구간 암호화: SQL Server TDE, 파일 서버 BitLocker 적용 검토.
- 민감 정보: 사용자 계정/이력 로그는 최소한으로 저장, PII 미포함.

## 4. 감사 및 로깅
- WebAPI: Serilog → Elastic/Splunk, 필수 필드(traceId, userId, action).
- History 테이블이 기본 감사 로그 역할, 추가로 Admin 활동 별도 테이블.
- CMD 서비스: 명령 로그(요청자, 명령, 파라미터, 결과, 실행 시간) 유지.
- 로그 보존 정책: 최소 1년 저장, 감사팀 요청 시 3년까지 확장.

## 5. 보안 테스트 계획
- 정적 분석: SonarQube 또는 Visual Studio Code Analysis.
- 취약점 테스트: OWASP ZAP 내부망 스캔, SMB 접근 권한 검증.
- 침투 테스트: 연 1회 외부 감사팀 수행.

## 6. 규정 준수
- 내부 보안 규정: 제조 데이터 접근 지침 준수.
- ISO 27001/9001 대응: 문서 기록(승인 이력, 변경 관리) 유지.
- 라이선스: 사용 OSS의 라이선스 스캔(Third-Party Notice).

## 7. 교육 및 운영 절차
- 사용자 교육: 승인 절차, 파일 업로드 규칙, CMD 명령 요청 방법 안내.
- 운영팀 매뉴얼: 서비스 계정 관리, 비상시 접근 절차.
- 보안 사고 대응 프로세스: 감지 → 신고 → 격리 → 복구 → 보고.

## 8. 주니어 개발자 주의 사항
- 민감 로그 남기지 않기, 예외 메시지에 내부 경로/비밀번호 포함 금지.
- HTTPS 인증서 갱신 자동화(PowerShell 스크립트 + 문서화).
- 테스트 데이터에도 실제 생산 데이터 사용 금지.

## 9. 오픈 이슈
- CMD 서비스 명령 서명 필요 여부(MS Authenticode 검토).
- TLS 인증서 발급 경로(사내 CA vs 공인 CA) 확정.
- 로그 중앙화 플랫폼(Splunk/Elastic) 최종 결정.
